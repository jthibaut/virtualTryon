DEPOT GITHUB

git clone https://github.com/TON_COMPTE/virtual-tryon
cd virtual-tryon
pip install -r requirements.txt
streamlit run app.py

ARBORESCENCE

virtual-tryon/
â”‚
â”œâ”€â”€ app.py
â”œâ”€â”€ tryon.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â”‚
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ placeholder_user.png
â”‚   â””â”€â”€ placeholder_cloth.png
â”‚
â”œâ”€â”€ input/
â”‚   â””â”€â”€ (tu mets tes photos ici)
â”‚
â”œâ”€â”€ clothes/
â”‚   â””â”€â”€ (tes vÃªtements ici)
â”‚
â””â”€â”€ models/
    â””â”€â”€ (tÃ©lÃ©chargÃ© automatiquement)

requirements.txt
torch==2.1.0
torchvision==0.16.0
opencv-python
Pillow
numpy
streamlit
huggingface-hub
einops
tqdm
scipy

tryon.py
import torch
from huggingface_hub import snapshot_download
from PIL import Image
import numpy as np
import cv2
import os

MODEL_DIR = "models/tryon_full"

def download_model():
    if not os.path.exists(MODEL_DIR):
        print("ðŸ“¥ TÃ©lÃ©chargement du modÃ¨le TryOnDiffusion...")
        snapshot_download(
            repo_id="diffusers/tryondiffusion",
            local_dir=MODEL_DIR,
            local_dir_use_symlinks=False
        )
        print("âœ” ModÃ¨le tÃ©lÃ©chargÃ©.")

def load_image(path):
    return Image.open(path).convert("RGB")

def run_tryon(user_img_path, cloth_img_path, output_path="output.png"):
    """
    Version simplifiÃ©e du pipeline TryOnDiffusion standard.
    """
    from diffusers import StableDiffusionInpaintPipeline

    download_model()

    pipe = StableDiffusionInpaintPipeline.from_pretrained(
        MODEL_DIR,
        torch_dtype=torch.float16
    ).to("cuda")

    user_img = load_image(user_img_path)
    cloth_img = load_image(cloth_img_path)

    # CrÃ©ation d'une simple segmentation approximative
    cloth_resized = cloth_img.resize((256, 256))
    mask = cloth_resized.convert("L")

    result = pipe(
        prompt="person wearing this piece of clothing realistically, high quality, sharp, natural",
        image=user_img,
        mask_image=mask
    ).images[0]

    result.save(output_path)
    return output_path


app.py

import streamlit as st
import os
from PIL import Image
from tryon import run_tryon

st.set_page_config(page_title="Virtual TryOn", layout="wide")

INPUT_DIR = "input"
CLOTH_DIR = "clothes"
HISTORY_DIR = "history"

os.makedirs(HISTORY_DIR, exist_ok=True)

st.title("ðŸ§ª Essayage Virtuel - Interface AvancÃ©e")

# ---- COLONNES ----
col_user, col_cloth, col_preview = st.columns([1,1,2])

# ---- Upload utilisateur ----
with col_user:
    st.subheader("ðŸ“¸ Photo utilisateur")
    user_file = st.file_uploader("Choisis une photo", type=["png","jpg","jpeg"])
    if user_file:
        user_img = Image.open(user_file).convert("RGB")
        st.image(user_img, caption="Photo utilisateur", use_container_width=True)
        user_path = os.path.join(INPUT_DIR, "user.png")
        user_img.save(user_path)

# ---- Catalogue vÃªtements ----
with col_cloth:
    st.subheader("ðŸ‘• Catalogue de vÃªtements")

    clothes = [f for f in os.listdir(CLOTH_DIR) if f.lower().endswith(("png","jpg","jpeg"))]

    if not clothes:
        st.warning("Ajoute des vÃªtements dans le dossier clothes/")
    else:
        cloth_choice = st.selectbox("Choisis un vÃªtement", clothes)
        cloth_path = os.path.join(CLOTH_DIR, cloth_choice)
        st.image(cloth_path, caption="VÃªtement choisi", use_container_width=True)

# ---- Zone PrÃ©visualisation / RÃ©sultat ----
with col_preview:
    st.subheader("ðŸ–¼ AperÃ§u rendu")

    if st.button("ðŸ”® GÃ©nÃ©rer le rendu"):
        if user_file and cloth_choice:
            output_path = os.path.join(HISTORY_DIR, "result.png")
            with st.spinner("GÃ©nÃ©ration en cours..."):
                result = run_tryon(user_path, cloth_path, output_path)
            st.success("Rendu gÃ©nÃ©rÃ© !")
            st.image(result, caption="RÃ©sultat", use_container_width=True)
        else:
            st.error("Ajoute une photo utilisateur et choisis un vÃªtement")

# ---- Historique ----
st.subheader("ðŸ“š Historique")

history_files = sorted(os.listdir(HISTORY_DIR))
for h in history_files:
    st.image(os.path.join(HISTORY_DIR, h), width=150)


readme.md
# Virtual TryOn - Interface AvancÃ©e

Application dâ€™essayage virtuel utilisant **TryOnDiffusion (modÃ¨le complet)**.

## ðŸš€ Lancement

```bash
pip install -r requirements.txt
streamlit run app.py
